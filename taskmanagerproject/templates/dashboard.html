{% extends "base.html" %}
{% block title %}Dashboard • Task Manager{% endblock %}
{% block content %}

{% include "includes/greeting.html" %}

<div class="mb-2" style="display:flex; gap:.6rem; align-items:center;">
  <h1 class="heading heading--xl text-gradient mb-0">Dashboard</h1>
  <a class="btn btn--gradient" href="{% url 'task_create' %}">+ New Task</a>
</div>

<div class="grid-2">
  <section class="card">
    <h2 class="heading heading--l text-primary">Recent Tasks</h2>
    {% if tasks %}
      <table class="table">
        <thead>
          <tr><th>Title</th><th>Priority</th><th>Status</th><th>Due</th><th></th></tr>
        </thead>
        <tbody>
        {% for t in tasks %}
          <tr>
            <td>{{ t.title }}</td>
            <td class="chip chip--{{ t.priority }}">{{ t.priority|title }}</td>
            <td>{{ t.status|title }}</td>
            <td>{{ t.due_date|date:"Y-m-d H:i" }}</td>
            <td style="text-align:right; white-space:nowrap;">
              <a class="btn" href="{% url 'task_edit' t.id %}">Edit</a>
              <a class="btn btn--danger" href="{% url 'task_delete' t.id %}">Delete</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <p class="text-muted mt-1">Use the API for full CRUD: <code>/tasks/</code></p>
    {% else %}
      <div class="text-muted">
    <p class="mb-1">No tasks yet.</p>
  </div>
    {% endif %}
  </section>

  <section class="card">
    <h2 class="heading heading--l text-secondary">Latest Notifications</h2>
    {% if notifications %}
      <ul class="list">
        {% for n in notifications %}
          <li class="list__item {% if not n.is_read %}unread{% endif %}">
            <div>{{ n.message }}</div>
            <small class="text-muted">{{ n.created_at|date:"Y-m-d H:i" }}</small>
          </li>
        {% endfor %}
      </ul>
      <p class="text-muted mt-1">Mark as read via API: <code>POST /notifications/mark_all_read/</code></p>
    {% else %}
      <p class="text-muted">You’re all caught up.</p>
    {% endif %}
  </section>
</div>
{% endblock %}

